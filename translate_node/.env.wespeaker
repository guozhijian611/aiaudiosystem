# ===============================
# WeSpeaker è¯´è¯äººåˆ†ç¦»é…ç½®
# WeSpeaker Speaker Diarization Configuration
# ===============================

# RabbitMQé…ç½®
RABBITMQ_HOST=10.0.0.130
RABBITMQ_PORT=5672
RABBITMQ_USERNAME=admin
RABBITMQ_PASSWORD=admin
RABBITMQ_VIRTUAL_HOST=/

# é˜Ÿåˆ—åç§°
QUEUE_NAME=transcribe_queue

# åç«¯APIé…ç½®
API_BASE_URL=http://10.0.0.130:8787
API_UPLOAD_ENDPOINT=/queue/upload
API_CALLBACK_ENDPOINT=/queue/callback

# å·¥ä½œç›®å½•é…ç½®
WORK_DIR=./work
TEMP_DIR=./temp
LOG_LEVEL=INFO

# WhisperXè½¬å†™é…ç½®
WHISPER_MODEL=large-v2
WHISPER_LANGUAGE=auto
WHISPER_DEVICE=auto
WHISPER_COMPUTE_TYPE=float16
WHISPER_BATCH_SIZE=2

# ===============================
# WeSpeaker è¯´è¯äººåˆ†ç¦»é…ç½®
# WeSpeaker Speaker Diarization Configuration
# ===============================

# åŸºç¡€è¯´è¯äººåˆ†ç¦»é…ç½®
ENABLE_DIARIZATION=true

# ğŸ¯ WeSpeaker æ¨¡å‹é…ç½® (æ¨èç”¨äºä¸­æ–‡å’Œå¤šè¯­è¨€)
DIARIZATION_MODEL=wespeaker/wespeaker-voxceleb-resnet34-LM
DIARIZATION_BACKEND=wespeaker

# ğŸ”‘ ä¸éœ€è¦ HF_TOKEN (WeSpeaker çš„ä¼˜åŠ¿)
HF_TOKEN=

# è¯´è¯äººæ•°é‡é…ç½®
MIN_SPEAKERS=1
MAX_SPEAKERS=10

# ğŸ¯ WeSpeaker ä¸“ç”¨å‚æ•°
SPEAKER_SIMILARITY_THRESHOLD=0.35      # WeSpeaker æ¨èé˜ˆå€¼ (0.3-0.5)
MINIMUM_SEGMENT_DURATION=0.4           # æœ€å°æ®µè½æ—¶é•¿ (0.2-0.8)

# WeSpeaker åµŒå…¥é…ç½®
SPEAKER_EMBEDDING_DIM=256              # WeSpeaker åµŒå…¥ç»´åº¦
SPEAKER_EMBEDDING_MODEL=resnet34       # åµŒå…¥æ¨¡å‹æ¶æ„
SPEAKER_CLUSTERING_METHOD=spectral     # èšç±»æ–¹æ³• (spectral å¯¹ WeSpeaker æ•ˆæœæ›´å¥½)

# WeSpeaker é«˜çº§é…ç½®
WESPEAKER_DEVICE=auto                  # è®¾å¤‡é€‰æ‹©
WESPEAKER_BATCH_SIZE=16                # æ‰¹å¤„ç†å¤§å°
WESPEAKER_SCORE_THRESHOLD=0.5          # åˆ†æ•°é˜ˆå€¼
WESPEAKER_CLUSTER_TYPE=spectral        # èšç±»ç±»å‹

# è¯­è¨€å¯¹é½é…ç½®
ENABLE_ALIGNMENT=true
ALIGNMENT_MODEL=jonatasgrosman/wav2vec2-large-xlsr-53-chinese-zh-cn  # ä¸­æ–‡ä¼˜åŒ–å¯¹é½æ¨¡å‹

# å¤„ç†é™åˆ¶é…ç½®
MAX_AUDIO_DURATION=3600
PROCESSING_TIMEOUT=7200
CHUNK_DURATION=600

# è¾“å‡ºæ ¼å¼é…ç½®
OUTPUT_FORMAT=json
INCLUDE_TIMESTAMPS=true
INCLUDE_CONFIDENCE=true

# æ¨¡å‹ç¼“å­˜é…ç½®
MODEL_CACHE_DIR=./models
DISABLE_UPDATE=true

# é˜Ÿåˆ—é…ç½®
QUEUE_TTL=3600000
QUEUE_DURABLE=true

# å…¶ä»–é…ç½®
MAX_WORKERS=1
DOWNLOAD_TIMEOUT=300
WHISPERX_PATH=./whisperX

# ===============================
# æ€§èƒ½ä¼˜åŒ–é…ç½®
# Performance Optimization
# ===============================

# GPUå†…å­˜ç®¡ç†
CUDA_MEMORY_FRACTION=0.7
PYTORCH_CUDA_ALLOC_CONF=max_split_size_mb:256

# æ‰¹å¤„ç†ä¼˜åŒ–
DIARIZATION_BATCH_SIZE=1
SPEAKER_EMBEDDING_BATCH_SIZE=16

# ===============================
# WeSpeaker å®‰è£…è¯´æ˜
# WeSpeaker Installation Guide
# ===============================

# 1. å®‰è£… WeSpeaker
# pip install wespeaker

# 2. å¦‚æœä½¿ç”¨ conda
# conda install -c conda-forge wespeaker

# 3. ä½¿ç”¨æœ¬é…ç½®æ–‡ä»¶
# cp .env.wespeaker .env

# 4. é‡å¯æœåŠ¡
# docker-compose restart

# ===============================
# æ”¯æŒçš„ WeSpeaker æ¨¡å‹
# Supported WeSpeaker Models
# ===============================

# åŸºç¡€æ¨¡å‹
# wespeaker/wespeaker-voxceleb-resnet34-LM     # æ¨è
# wespeaker/wespeaker-voxceleb-resnet152-LM    # æ›´é«˜ç²¾åº¦
# wespeaker/wespeaker-cnceleb-resnet34-LM      # ä¸­æ–‡ä¼˜åŒ–

# å¤šè¯­è¨€æ¨¡å‹
# wespeaker/wespeaker-multilingual-resnet34    # å¤šè¯­è¨€æ”¯æŒ
# wespeaker/wespeaker-multilingual-resnet152   # å¤šè¯­è¨€é«˜ç²¾åº¦ 